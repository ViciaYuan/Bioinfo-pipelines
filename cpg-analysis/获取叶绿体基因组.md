# 使用总DNA建库获取叶绿体基因组

直接用的老师写的脚本...

## 最终结果的文件结构

├── KT781591.fasta
├── KT963036.fasta
├── KT963037.fasta
├── KT963038.fasta
├── KX118044.fasta
├── MF594405.fasta
├── NC_029391.fasta
├── NC_029392.fasta
├── NC_029393.fasta
├── SQ_H3K5YDMXX_L1_1.clean.fq.gz
├── SQ_H3K5YDMXX_L1_2.clean.fq.gz
└── results
    ├── K
    ├── K127.cns.fas
    ├── K127.out.sam
    ├── NC_029391.all.cns.fas
    ├── NC_029391.all.gap.cns.fas
    ├── NC_029391.all.mapped_1.fq
    ├── NC_029391.all.mapped_2.fq
    ├── NC_029391.all.out.sam
    ├── NC_029391.final.cns.fas
    ├── NC_029391.reads.cns.fas
    ├── NC_029391.reads.out.sam
    ├── combine.mapped_1.fq
    ├── combine.mapped_2.fq
    └── logs


<br>

## 原始文件的结构为

├── script.sh
├── KT781591.fasta
├── KT963036.fasta
├── KT963037.fasta
├── KT963038.fasta
├── KX118044.fasta
├── MF594405.fasta
├── NC_029391.fasta
├── NC_029392.fasta
├── NC_029393.fasta
├── SQ_H3K5YDMXX_L1_1.clean.fq.gz
└── SQ_H3K5YDMXX_L1_2.clean.fq.gz

script为使用总DNA建库获取叶绿体基因组流程的脚本；.fasta文件为伞形科其他几种植物的叶绿体基因组参考序列；.clean.fq.gz为测序得到的原始数据。

将整个文件夹拖到终端执行，过一晚上差不多就跑完了。

<br>

## 处理流程（script.sh）

0. 初始设定

* 设定clean reads两端文件的文件名
* 设定线程数
* 设定K值的运行范围

1. 在Geneious里下载参考序列

使用下列语句查询
```
#获取当归属叶绿体基因组序列
Angelica[TITLE] AND complete genome[TITLE] AND chloroplast[TITLE]

#或者这个
txid1753[ORGN] AND complete genome[TITLE] AND chloroplast[TITLE]
```

参考序列可以事先拷到和脚本相同文件夹里，1、2步就不用再操作。

2. 将获得的每条序列导出到script.sh所在文件夹，并合并为cp.combine

```
#导出序列
Geneious: File->Export->Batch Export (File Format:FASTA sequences/alignment)

#合并为cp.combine
cat *.fasta>cp.combine
```

3. 为cp.combine和每一条fasta序列用bowtie2-build建立索引
```

bowtie2-build cp.combine cp.index.combine >index.log 2>&1
for s in $(ls *.fasta); do bowtie2-build $s ${s%.*}.index;done >>index.log 2>&1
```

4. 将clean reads用bowtie2进行map
5. 使用samtools bedtools进行排序和筛选
6. 对所有参考序列依次进行map
7. 显示统计数字，挑选最好的参考序列(排列最后一个为最好)
8. SOAPdenovo生成contig，找到N50最大的一个(找到最好的K)
9. map所有的contig到最好的参考序列
10. 删除特别差的contig，合并剩下的contig，bowtie2到参考序列，生成一条consensus序列备用
11. 使用Tablet修订
12. 分别导入Tablet,看哪个的Feature最少,等待10秒,输入w继续等待,默认为all
13. 把最好的合并后的序列中没有map上的用N表示（之前所有consensus没map上的都是跟参考序列一致），注意这一步中bcftools call的参数为-m不是-mv
14. 从clean reads中以合并后去N的序列为参考，获得成对fastq
15. 用输出的成对fastq再次对$best_ref.$best_seq.N.cns.fas进行map，作出的consensus即为最终序列$best_ref.final.cns.fas

16. 移动结果到result文件夹，清理生成的文件，运行完毕输出提示


The END.

利用与参考序列比较，从总DNA中得到了进行下一步需要的叶绿体基因组。

下一步是
<!--组装成环，然后注释，修正，提交。要去实验室啊！弄完这个就去实验室接着做...-->












